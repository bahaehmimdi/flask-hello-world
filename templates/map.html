<!DOCTYPE html>
<html>
<head>
    <title>Google Maps with Flask</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB33ACVQvP1lE5gK5nnARM_VEmr0eSP_ic"></script>
</head>
<body>

<div id="map" style="height: 500px; width: 100%;"></div>

<script>
    function createMarker(location, map) {
        var marker = new google.maps.Marker({
            position: {lat: location.latitude, lng: location.longitude},
            map: map,
            title: location.name
        });

        marker.addListener('click', function() {
            alert('You clicked on ' + location.name);
        });
    }

    function initMap(locations) {
        if (!locations || locations.length === 0) {
            console.error('No locations provided.');
            return;
        }

        var center = {lat: locations[0].latitude, lng: locations[0].longitude};
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 10,
            center: center
        });

        for (var i = 0; i < locations.length; i++) {
            createMarker(locations[i], map);
        }
    }

    // Fetch data from /l endpoint and then initialize the map
    fetch('/l')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            var locationsArray = Object.values(data); // Convert the object to an array
            initMap(locationsArray);
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });

</script>

</body>
</html>
